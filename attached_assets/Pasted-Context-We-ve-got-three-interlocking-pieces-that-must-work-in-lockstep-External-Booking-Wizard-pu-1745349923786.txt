Context
We’ve got three interlocking pieces that must work in lockstep:

External Booking Wizard (public page)

Internal “New Appointment” Modal (admin UI)

Booking Page Master (admin setup of which facilities & appointment types appear on the public page)

High‑Level Requirements

Form fields & order everywhere must follow exactly the “Appointment Master → Custom Questions → Availability Rules → General Settings” schema.

BOL upload (optional or required per appointment master question) must live on Step 1 in both flows, trigger OCR when present, be compressed, and persist alongside the appointment record.

Date/time selection must use facility‑level hours (with optional overrides) and reflect real‑time remaining slots. Both flows must hit the same /api/availability data.

Dock selection must be truly optional unless marked required in Appointment Master.

Booking Page Master UI must allow you to select facilities and then pick exactly the associated appointment types for each facility (show counts, allow expand/collapse, validation).

Tasks

External Booking Wizard

Reorder Step 1 to:

Location dropdown (facilities)

Appointment Type dropdown (filtered by chosen facility)

Pickup/Dropoff radio

BOL Upload component (optional/required flag from master)

Ensure /api/availability?facilityId=…&appointmentTypeId=…&date=… returns full slot objects with available + remaining. Display correctly and disable past/closed hours.

Fix “Create Appointment” submit so it actually writes to the DB and surfaces errors inline, not a generic alert.

Internal New Appointment Modal

Wrap modal content in a single FormProvider so useFormContext() is never null.

Mirror external’s Step 1 fields in the same order (including BOL upload & OCR).

Make date/time picker respect the same availability rules and facility hours.

Dock field truly optional unless required.

After submit or on modal close, reset form state so reopening shows a blank slate.

Booking Page Master

In the “Facilities & Appointment Types” panel, show a card for each selected facility. Under each, list only its appointment types with a checkbox.

Display “n of n selected” per facility.

Validate that at least one appointment type is selected per facility before allowing “Update.”

Acceptance Criteria

External and internal flows work end‑to‑end: you can pick a location, appointment type, date/time only within open hours, upload a BOL (if required or optional), and successfully create an appointment.

No console/network errors around availability-rules or useFormContext().

Booking Page Master UI visually shows each facility’s appointment types, allows toggling, and validates correctly.

BOL OCR plugin runs on every upload, extracts customer, carrier, date, notes, and saves that data alongside the appointment.

Please checkpoint after each major area (External → Internal → Master), share screenshots of the working happy path, and call out any blockers immediately.