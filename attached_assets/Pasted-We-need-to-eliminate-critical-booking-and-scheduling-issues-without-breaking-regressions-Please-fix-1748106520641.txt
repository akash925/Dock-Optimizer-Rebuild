We need to eliminate critical booking and scheduling issues without breaking regressions. Please fix the following issues with precision:

‚úÖ 1. Modal Crash on Appointment Click
Symptom: Clicking on a newly created appointment card causes a hard crash.

Root Cause: The modal is trying to access bolDocument.originalName without checking if bolDocument exists.

Fix Instructions:

Open client/src/components/schedules/appointment-details-dialog.tsx

Anywhere referencing:

tsx
Copy
Edit
bolDocument.originalName
or similar, wrap it safely:

tsx
Copy
Edit
bolDocument?.originalName ?? "No document uploaded"
If rendering UI conditionally on BOL, use:

tsx
Copy
Edit
{bolDocument && (
  <div>{bolDocument.originalName}</div>
)}
Confirm that the modal receives bolDocument?: { originalName: string; path: string; } in the type interface.

Ensure no unguarded destructuring of appointment.bolDocuments[0].

‚úÖ 2. BOL Document Missing in Appointment Modal
Symptom: Even though a BOL was uploaded and linked, it doesn't show in the Appointment modal.

Fix Instructions:

Confirm that the API fetching appointment details joins appointment_bol_links ‚Üí bol_documents.

That means when rendering an appointment in the modal, it should receive bolDocuments or bolDocumentPath.

Update the backend service if needed to ensure this link:

ts
Copy
Edit
include: {
  bolDocuments: true
}
Frontend: Display the uploaded BOL file name + download link if available.

‚úÖ 3. Confirmation Code Mismatch
Symptom: Booking page shows HZL-718384 but modal shows HZL-000121.

Fix Instructions:

Always use appointment.confirmationCode from the backend, don‚Äôt regenerate it on the frontend.

Open:

client/src/pages/external-booking-confirmation.tsx

client/src/components/schedules/appointment-details-dialog.tsx

Replace any logic like:

tsx
Copy
Edit
`HZL-${appointment.id.toString().padStart(6, '0')}`
with:

tsx
Copy
Edit
appointment.confirmationCode
Confirm backend sets this value at appointment creation and it‚Äôs consistent across the frontend.

‚úÖ 4. Calendar Header Layout / Whitespace
Symptom: The calendar day header columns have unnecessary padding/margin between days.

Fix Instructions:

Open client/src/components/calendar/calendar-enhanced.css

Add or update styles targeting .fc-col-header-cell or .fc-timegrid-col:

css
Copy
Edit
.fc-col-header-cell {
  padding: 0 !important;
  margin: 0 !important;
}
.fc-timegrid-col.fc-day {
  padding: 0 !important;
  margin: 0 !important;
  width: calc(100% / 7) !important;
}
‚úÖ 5. Final Booking Page Missing Appointment Info
Symptom: Confirmation screen does not show key appointment details like truck number, BOL number, driver.

Fix Instructions:

Ensure the appointment booking POST response includes the full appointment object with all fields.

In client/src/pages/external-booking-confirmation.tsx, hydrate the confirmation page using that response.

Render fields such as:

appointment.driverName

appointment.truckNumber

appointment.bolNumber

appointment.confirmationCode

‚úÖ 6. Timezone Offset Check (Eastern Facility, Pacific User)
Symptom: Appointments appear 4 hours early.

Fix Instructions:

Validate that startTime is serialized in the facility‚Äôs timezone, not UTC or user‚Äôs local time.

Ensure DateTime.fromISO(appointment.startTime, { zone: facilityTimezone }) is used if using Luxon.

Check frontend Calendar or WeekView uses the correct timezone conversion logic.

üîê Final Validation
After implementing the above:

Create a booking with a BOL upload.

Ensure confirmation screen shows accurate data.

Check calendar card renders in the correct column + time.

Click on the card to open modal ‚Äî should not crash.

Confirm BOL appears in the modal.

Confirm confirmation code matches across views.

Confirm no regressions to external booking flow.

