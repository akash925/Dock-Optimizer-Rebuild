Context:
In our “Edit Booking Page” modal (BookingPageForm), un‑ and re‑checking appointment types currently blows up with “Maximum update depth exceeded” and never actually persists to the server. As a result the external wizard (and internal modal) never pick up any new facility↔type mappings.

Goals:

Booking‑Page Master

Fix the infinite‑render loop: remove any setState calls inside a render or unguarded useEffect. Only update local form state in direct response to user events or in a single useEffect whose dependency list is carefully scoped.

Hook the form into React Hook Form (or your current form library) so that data lives in its own controller, not in ad‑hoc useState calls.

On submit, gather:

ts
Copy
Edit
{
  name,
  introText,
  successMessage,
  active,
  facilityIds: number[],
  appointmentTypeIds: number[]
}
Call PUT /api/booking-pages/:id with that payload, await and handle JSON errors, and then on success close the modal and re‑fetch the booking‑pages list.

Surface any validation errors returned by the server in the red alert box.

External Booking Wizard

Change its API call to GET /api/availability?bookingPageId=…&date=… so it only shows slots for the types the admin has just saved.

After saving the booking‑page, hitting Refresh (or re‑navigating) should immediately show the new types in the Location→Type dropdown.

Internal “New Appointment” Modal

Mirror the same fix: read the saved bookingPageId filter and only render the facility↔type pairs that the admin selected.

Ensure its submit button calls the same availability logic and POSTs to /api/appointments with the correct bookingPageId, facilityId, and appointmentTypeId.

Deliverables:

BookingPageForm.tsx (or .tsx) showing:

a properly configured useForm or FormProvider,

a single guarded useEffect (if needed) for initial data load,

an onSubmit that calls the PUT route and handles errors.

Express/Node route for PUT /api/booking-pages/:id (or your framework) with payload validation and join‑table updates.

ExternalBookingWizard.tsx and InternalAppointmentModal.tsx changes showing the new bookingPageId‑aware fetch and dropdown population.

A smoke‑test script (or description) that:

Admin checks “450 Airtech Pkwy” + “1‑Hour Trailer” → Save

External Wizard now shows “1‑Hour Trailer” under that location

Internal Modal likewise only offers that type.